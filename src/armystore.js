var Reflux = require('reflux'),
    actions = require('./actions'),
    _ = require('lodash');

var localStorageKey = "LordsOfWarArmies";

module.exports = Reflux.createStore({
  listenables: [actions],
  onAddArmy: function(name){
    this.DB[name] = {};
    this.update();
  },
  onAddCaderToArmy: function(name,list){
    _.each(list,function(unit){
      this.DB[name][unit.id] = true;
    },this);
    this.update();
  },
  onRemoveCaderFromArmy: function(name,list){
    _.each(list,function(unit){
      delete this.DB[name][unit.id];
    },this);
    this.update();
  },
  onDeleteArmy: function(name){
    delete this.DB[name];
    this.update();
  },
  onAddUnitToArmy: function(name,id){
    //console.log("ADDING",name,id);
    this.DB[name][id] = true;
    this.update();
  },
  onRemoveUnitFromArmy: function(name,id){
    //console.log("DELETING",name,id);
    delete this.DB[name][id];
    this.update();
  },
  update: function(){
    localStorage.setItem(localStorageKey,JSON.stringify(this.DB));
    this.trigger(this.DB);
  },
  getInitialState: function(){
    return (this.DB = _.mapValues(JSON.parse(localStorage.getItem(localStorageKey)||"{}"),function(army){
      return _.reduce(_.keys(army),function(mem,oldid){
        mem[translation[oldid]||oldid]=true;
        return mem;
      },{});
    }));
  }
});



var translation = {
  id0: "teco_Father Nicodemus_53200000_0",
  id1: "teco_Brother Gabriel_30303030_0",
  id2: "teco_Brother Andronicus_34500012_0",
  id3: "teco_Palisade_11000001_0",
  id4: "teco_Palisade_11000001_1",
  id5: "teco_Palisade_11000001_2",
  id6: "teco_Simeon The Divine_00235320_0",
  id7: "teco_Templar Jackal_32000002_0",
  id8: "teco_Templar Jackal_32000002_1",
  id9: "teco_Templar Jackal_00023200_0",
  id10: "teco_Templar Jackal_00023200_1",
  id11: "teco_Templar Lancer_03530000_0",
  id12: "teco_Templar Lancer_03530000_1",
  id13: "teco_Templar Lancer_00000353_0",
  id14: "teco_Templar Lancer_00000353_1",
  id15: "teco_Templar Longsword_54000004_0",
  id16: "teco_The Merciful Sister_42000005_0",
  id17: "teco_Zadok The Confessor_20500050_0",
  id18: "teco_Templar Partisan_02100000_0",
  id19: "teco_Templar Partisan_00120000_0",
  id20: "teco_Templar Partisan_00000210_0",
  id21: "teco_Templar Partisan_00000012_0",
  id22: "teco_Templar Sanctifier_52000002_0",
  id23: "teco_Templar Sanctifier_52000002_1",
  id24: "teco_Templar Sanctifier_52000002_2",
  id25: "teco_Templar Sanctifier_00025200_0",
  id26: "teco_Templar Zealot_13100000_0",
  id27: "teco_Templar Zealot_00131000_0",
  id28: "teco_Templar Zealot_00001310_0",
  id29: "teco_Templar Zealot_10000013_0",
  id30: "teco_Templar Longbow_22000002_0",
  id31: "teco_Templar Longbow_22000002_1",
  id32: "teco_Templar Longbow_22000002_2",
  id33: "teco_Templar Trebuchet_02000002_0",
  id34: "teco_Templar Trebuchet_02000002_1",
  id35: "teco_Templar Trebuchet_02000002_2",
  id36: "tepr_Mother Superior_01110111_0",
  id37: "tebo_Templar Longsword_00045400_0",
  id38: "tebo_Templar Longbow_00022200_0",
  id39: "tebo_Templar Longbow_00022200_1",
  id40: "tebo_Templar Trebuchet_00020200_0",
  id41: "tebo_Templar Trebuchet_00020200_1",
  id42: "unco_Azul the Bygone King_00404040_0",
  id43: "unco_Banshee_53030303_0",
  id44: "unco_Banshee_53030303_1",
  id45: "unco_Blood Golem_14100014_0",
  id46: "unco_Black Rider_05350000_0",
  id47: "unco_Black Rider_00000535_0",
  id48: "unco_Ceithrel Nightwalker_00505050_0",
  id49: "unco_Cerberus_00044400_0",
  id50: "unco_Headless Horseman_04340000_0",
  id51: "unco_Headless Horseman_04340000_1",
  id52: "unco_Headless Horseman_00000434_0",
  id53: "unco_Headless Horseman_00000434_1",
  id54: "unco_Hellhound_00134310_0",
  id55: "unco_Hellhound_00134310_1",
  id56: "unco_Oozool the Putrid_21312131_0",
  id57: "unco_Plague Launcher_11111111_0",
  id58: "unco_Plague Launcher_11111111_1",
  id59: "unco_Plague Launcher_11111111_2",
  id60: "unco_Rib Quiver_33100013_0",
  id61: "unco_Skeleton Archer_11000001_0",
  id62: "unco_Skeleton Archer_11000001_1",
  id63: "unco_Skeleton Archer_11000001_2",
  id64: "unco_Skeleton Archer_11000001_3",
  id65: "unco_Skeleton Spearman_12100000_0",
  id66: "unco_Skeleton Spearman_12100000_1",
  id67: "unco_Skeleton Spearman_10000012_0",
  id68: "unco_Skeleton Spearman_10000012_1",
  id69: "unco_Volus the Defiler_53001003_0",
  id70: "unco_Zombie Gnasher_43000003_0",
  id71: "unco_Zombie Gnasher_43000003_1",
  id72: "unco_Zombie Gnasher_00034300_0",
  id73: "unco_Zombie Gnasher_00034300_1",
  id74: "unco_Zombie Halberd_01100011_0",
  id75: "unco_Zombie Halberd_01100011_1",
  id76: "unco_Zombie Halberd_01100011_2",
  id77: "unco_Zombie Shambler_11000001_0",
  id78: "unpr_Chancellor Snow_43111113_0",
  id79: "unbo_Skeleton Archer_00011100_0",
  id80: "unbo_Skeleton Archer_00011100_1",
  id81: "unbo_Plague Launcher_11111111_0",
  id82: "unbo_Plague Launcher_11111111_1",
  id83: "unbo_Blood Golem_00141410_0",
  id84: "elco_Erendrial Aegis_34200024_0",
  id85: "elco_Elven Dragoon_21000233_0",
  id86: "elco_Elven Dragoon_23320001_0",
  id87: "elco_Elven Royal Guard_32200022_0",
  id88: "elco_Elven Royal Guard_32200022_1",
  id89: "elco_Elven Lancemaster_00015100_0",
  id90: "elbo_Elven Lancemaster_51000001_0",
  id91: "elco_Elven Archer_11100011_0",
  id92: "elco_Elven Archer_11100011_1",
  id93: "elco_Elven Archer_11100011_2",
  id94: "elbo_Elven Archer_00111110_0",
  id95: "elbo_Elven Archer_00111110_1",
  id96: "elco_Elven Swordsquall_22200122_0",
  id97: "elco_Elven Swordsquall_22210022_0",
  id98: "elco_Elven Bowmaiden_22100012_0",
  id99: "elco_Elven Bowmaiden_22100012_1",
  id100: "elbo_Elven Bowmaiden_00122210_0",
  id101: "elbo_Elven Bowmaiden_00122210_1",
  id102: "elco_Elven Chariot_24542000_0",
  id103: "elco_Elven Chariot_20002454_0",
  id104: "elco_Elven Ballista_20000000_0",
  id105: "elco_Elven Ballista_20000000_1",
  id106: "elco_Elven Lightedge_31000002_0",
  id107: "elco_Elven Lightedge_32000001_0",
  id108: "elco_Elven Lancewielder_11300000_0",
  id109: "elco_Elven Lancewielder_10000031_0",
  id110: "elco_Elven Battle Tiger_02320000_0",
  id111: "elco_Elven Battle Tiger_00000232_0",
  id112: "elco_Elven Puresoul_05500000_0",
  id113: "elco_Elven Puresoul_00550000_0",
  id114: "elco_Elven Puresoul_00000550_0",
  id115: "elco_Elven Puresoul_00000055_0",
  id116: "elco_Elven Spearman_11100000_0",
  id117: "elco_Elven Spearman_00111000_0",
  id118: "elco_Elven Spearman_00001110_0",
  id119: "elco_Elven Spearman_10000011_0",
  id120: "elco_Amara Silvershadow_50304030_0",
  id121: "elco_Vanir Alfheim_02310132_0",
  id122: "elco_Narcissus Foxglove_40300030_0",
  id123: "elco_Eridia Lifrius_21400041_0",
  id124: "elco_Beladir Stormrider_53110113_0",
  id125: "elpr_Laerto Alfheim_01135311_0",
  id126: "elex_Lesser Dragon Rider_52201022_0",
  id127: "elex_Lesser Dragon Rider_10225220_0",
  id128: "elex_Golden Eagle_23200000_0",
  id129: "elex_Golden Eagle_00232000_0",
  id130: "elex_Golden Eagle_00002320_0",
  id131: "elex_Golden Eagle_20000023_0",
  id132: "elex_Drow Huntress_40103010_0",
  id133: "elex_Castanea Solis_11111111_0",
  id134: "elex_Elder Unicorn_14411000_0",
  id135: "elex_Rioting Ent_00253520_0",
  id136: "elex_Faerie Warrior_11100011_0",
  id137: "elex_Faerie Warrior_00111110_0",
  id138: "elex_Ochrom the Wize_11100011_0",
  id139: "elpr_Easter Bunny_00055500_0",
  id140: "elpr_Poldarc the Dutiful_01111111_0",
  id141: "elpr_Zinnia Elegans_00242420_0",
  id142: "lico_Kai'itza of Xhotl_40400040_0",
  id143: "lico_Quillshot_30111110_0",
  id144: "lico_Quillshot_30111110_1",
  id145: "lico_Quillshot_30111110_2",
  id146: "lico_Quillshot_30111110_3",
  id147: "libo_Quillshot_11103011_0",
  id148: "libo_Quillshot_11103011_1",
  id149: "lico_Armoured Trike_34002004_0",
  id150: "lico_Armoured Trike_34002004_1",
  id151: "libo_Armoured Trike_20043400_0",
  id152: "lico_Crocodilian Brave_42302032_0",
  id153: "lico_Crocodilian Brave_42302032_1",
  id154: "lico_Leatherback_31011101_0",
  id155: "lico_Leatherback_31011101_1",
  id156: "lico_Shrine Guardian_00000414_0",
  id157: "lico_Shrine Guardian_00000414_1",
  id158: "lico_Shrine Guardian_04140000_0",
  id159: "lico_Shrine Guardian_04140000_1",
  id160: "lico_Compy Dasher_22000002_0",
  id161: "lico_Compy Dasher_02220000_0",
  id162: "lico_Compy Dasher_00022200_0",
  id163: "lico_Compy Dasher_00000222_0",
  id164: "lico_Lizardman Bulwark_21200000_0",
  id165: "lico_Lizardman Bulwark_21200000_1",
  id166: "lico_Lizardman Bulwark_20000021_0",
  id167: "lico_Lizardman Bulwark_20000021_1",
  id168: "lico_Cruor Sacrifice_05000005_0",
  id169: "lico_Cruor Sacrifice_05000005_1",
  id170: "lico_Cruor Sacrifice_00050500_0",
  id171: "lico_Cruor Sacrifice_00050500_1",
  id172: "lico_Skink Dartspitter_00000000_0",
  id173: "lico_Skink Dartspitter_00000000_1",
  id174: "lico_Skink Dartspitter_00000000_2",
  id175: "lico_Skink Dartspitter_00000000_3",
  id176: "libo_Skink Dartspitter_00000000_0",
  id177: "libo_Skink Dartspitter_00000000_1",
  id178: "lico_Zund-Va the Brave_04120214_0",
  id179: "lico_Chunkata Coldblood_52300032_0",
  id180: "lico_Dro'ka Klantos_00341430_0",
  id181: "lico_Huahua S'tonk_33001003_0",
  id182: "lico_Que-thil Sor'lax_32310132_0",
  id183: "lipr_King Tetras_51011101_0",
  id184: "liex_Phrynos Chordata_22203022_0",
  id185: "liex_Pterodactyl_12321010_0",
  id186: "liex_Pterodactyl_12321010_1",
  id187: "liex_Pterodactyl_10101232_0",
  id188: "liex_Pterodactyl_10101232_1",
  id189: "liex_Dilophosaurus_00101010_0",
  id190: "liex_Dilophosaurus_10100010_0",
  id191: "lipr_King Ctenoch_00324230_0",
  id192: "liex_Mehu Adohi_001111100_0",
  id193: "liex_Bestial Raptor_25210001_0",
  id194: "liex_Bestial Raptor_21000125_0",
  id195: "liex_Ankylodon_00400222_0",
  id196: "liex_Ankylodon_02220040_0",
  id197: "liex_Wretched Croaker_01410000_0",
  id198: "liex_Wretched Croaker_00000141_0",
  id199: "lipr_Gesh Acolyte_11013101_0",
  id200: "orco_Orc Warhog_23430000_0",
  id201: "orco_Orc Warhog_23430000_1",
  id202: "orco_Orc Warhog_20000343_0",
  id203: "orco_Orc Warhog_20000343_1",
  id204: "orco_Goblin Bow Pest_21000001_0",
  id205: "orco_Goblin Bow Pest_21000001_1",
  id206: "orco_Goblin Bow Pest_21000001_2",
  id207: "orco_Goblin Bow Pest_21000001_3",
  id208: "orco_Orc Deathbringer_53000003_0",
  id209: "orco_Orc Deathbringer_53000003_1",
  id210: "orco_Orc Deathbringer_00035300_0",
  id211: "orco_Orc Deathbringer_00035300_1",
  id212: "orco_Orc Butcher_43300033_0",
  id213: "orco_Orc Butcher_43300033_1",
  id214: "orco_Goblin Spider Rider_32210122_0",
  id215: "orco_Goblin Spider Rider_32210122_1",
  id216: "orco_Orc Ravager_32100005_0",
  id217: "orco_Orc Ravager_32100005_1",
  id218: "orco_Orc Ravager_35000012_0",
  id219: "orco_Orc Ravager_35000012_1",
  id220: "orco_Orc Catapult_00100010_0",
  id221: "orco_Orc Catapult_00100010_1",
  id222: "orco_Goblin Spikeman_01110000_0",
  id223: "orco_Goblin Spikeman_01110000_1",
  id224: "orco_Goblin Spikeman_00000111_0",
  id225: "orco_Goblin Spikeman_00000111_1",
  id226: "orco_Goblin Shanker_41000000_0",
  id227: "orco_Goblin Shanker_00014000_0",
  id228: "orco_Goblin Shanker_00004100_0",
  id229: "orco_Goblin Shanker_40000001_0",
  id230: "orco_Vanak Fleshripper_35100015_0",
  id231: "orco_Gonke Longtooth_55000005_0",
  id232: "orco_Ugluk Horsekiller_04200024_0",
  id233: "orco_Kragdish Blackmaw_13400043_0",
  id234: "orco_Snafu Bighorn_12230322_0",
  id235: "orco_Eruugor Bloodfist_30510150_0",
  id236: "orex_Orc Firestarter_11000001_0",
  id237: "orex_Orc Firestarter_01110000_0",
  id238: "orex_Orc Firestarter_00011100_0",
  id239: "orex_Orc Firestarter_00000111_0",
  id240: "orex_Murder of Crows_31111111_0",
  id241: "orex_Murder of Crows_11311111_0",
  id242: "orex_Murder of Crows_11113111_0",
  id243: "orex_Murder of Crows_11111131_0",
  id244: "orex_Blark Ironhide_11105011_0",
  id245: "orex_Xnurl Firebelly_11111111_0",
  id246: "orex_Frenzied Ogre_03030303_0",
  id247: "orex_Frenzied Ogre_03030303_1",
  id248: "orex_Orc Wyrm Driver_53101013_0",
  id249: "orex_Orc Wyrm Driver_10135310_0",
  id250: "orex_Orc Bloodskin_05310000_0",
  id251: "orex_Orc Bloodskin_00000135_0",
  id252: "orex_Orc Bullwhip_44000004_0",
  id253: "orex_Orc Bullwhip_00044400_0",
  id254: "orpr_Urgoth Skullsplitter_00150510_0",
  id255: "orpr_Fatty Loudmouth_21011101_0",
  id256: "orpr_Gastus Vile_00034300_0",
  id257: "orbo_Goblin Bow Pest_00012100_0",
  id258: "orbo_Goblin Bow Pest_00012100_1",
  id259: "orbo_Orc Catapult_00100010_0",
  id260: "orbo_Orc Catapult_00100010_1",
  id261: "orbo_Goblin Spider Rider_01223221_0",
  id262: "dwco_Dwarf Dowager_50000000_0",
  id263: "dwco_Dwarf Dowager_00500000_0",
  id264: "dwco_Dwarf Dowager_00005000_0",
  id265: "dwco_Dwarf Dowager_00000050_0",
  id266: "dwco_Dwarf Slugger_30000000_0",
  id267: "dwco_Dwarf Slugger_30000000_1",
  id268: "dwco_Dwarf Slugger_00300000_0",
  id269: "dwco_Dwarf Slugger_00000030_0",
  id270: "dwco_Dwarf Berserker_44000003_0",
  id271: "dwco_Dwarf Berserker_43000004_0",
  id272: "dwco_Dwarf Sharpshooter_00000000_0",
  id273: "dwco_Dwarf Sharpshooter_00000000_1",
  id274: "dwco_Dwarf Axethrower_33000003_0",
  id275: "dwco_Dwarf Axethrower_33000003_1",
  id276: "dwco_Dwarf Axethrower_00033300_0",
  id277: "dwco_Dwarf Axethrower_00033300_1",
  id278: "dwco_Dwarf Impaler_11110001_0",
  id279: "dwco_Dwarf Impaler_01111100_0",
  id280: "dwco_Dwarf Impaler_00011111_0",
  id281: "dwco_Dwarf Impaler_11000111_0",
  id282: "dwco_Dwarf Rock Hound_21012344_0",
  id283: "dwco_Dwarf Rock Hound_24432101_0",
  id284: "dwco_Dwarf Ballista_42000002_0",
  id285: "dwco_Dwarf Ballista_42000002_1",
  id286: "dwco_Dwarf Marauder_42100000_0",
  id287: "dwco_Dwarf Marauder_40000012_0",
  id288: "dwco_Dwarf Beastslayer_32000002_0",
  id289: "dwco_Dwarf Beastslayer_02320000_0",
  id290: "dwco_Dwarf Beastslayer_00023200_0",
  id291: "dwco_Dwarf Beastslayer_00000232_0",
  id292: "dwco_Ivor the Mad_42100012_0",
  id293: "dwco_Jaeger Drakesbane_02141412_0",
  id294: "dwco_Gordona Ironhelm_40404040_0",
  id295: "dwco_Krod Klouthammer_50000034_0",
  id296: "dwco_Deadeye Jones_43000003_0",
  id297: "dwco_Mungo Lancerammer_42200022_0",
  id298: "dwex_Dwarf Organ Gun_32000002_0",
  id299: "dwex_Dwarf Organ Gun_00023200_0",
  id300: "dwex_Dwarf Shield Maiden_11110001_0",
  id301: "dwex_Dwarf Shield Maiden_11000111_0",
  id302: "dwex_Iron Walker_20240420_0",
  id303: "dwex_Iron Walker_04202024_0",
  id304: "dwex_Forge Troll_40302030_0",
  id305: "dwex_Forge Troll_20304030_0",
  id306: "dwex_Thalin Haddin_11011101_0",
  id307: "dwex_Ragar Icebone_54300000_0",
  id308: "dwex_Mountain Hawk_22200022_0",
  id309: "dwex_Mountain Hawk_22200022_1",
  id310: "dwex_Mountain Hawk_00222220_0",
  id311: "dwex_Mountain Hawk_00222220_1",
  id312: "dwex_Dwarf Arcanist_11000001_0",
  id313: "dwex_Dwarf Arcanist_11000001_1",
  id314: "dwex_Dwarf Arcanist_00011100_0",
  id315: "dwex_Dwarf Arcanist_00011100_1",
  id316: "dwpr_Santa Claus_11510151_0",
  id317: "dwpr_Bon Bon the Bear_00224220_0",
  id318: "dwpr_Fodrin Rockbeard_20201020_0",
  id319: "dwpr_Ivana Ironhelm_04040404_0",
  id320: "dwbo_Dwarf Sharpshooter_00000000_0",
  id321: "dwbo_Dwarf Sharpshooter_00000000_1",
  id322: "dwbo_Dwarf Marauder_00124000_0",
  id323: "dwbo_Dwarf Marauder_00004210_0",
  id324: "dwbo_Dwarf Ballista_42000002_0"
};
